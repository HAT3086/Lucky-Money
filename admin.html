<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - L√¨ X√¨ 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        /* --- DARK THEME STYLES --- */
        body { 
            font-family: 'Montserrat', sans-serif; 
            padding: 20px; 
            background: #121212; /* Black Background */
            color: #ececec;      /* White Text */
        }
        
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: #1e1e1e; /* Dark Gray Container */
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 0 15px rgba(217, 4, 41, 0.3); /* Red Glow */
            border: 1px solid #333;
        }

        h1 { color: #f4d35e; text-align: center; margin-bottom: 20px; text-transform: uppercase; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #333; }
        
        th { background-color: #d90429; color: white; }
        
        /* Row Hover Effect */
        tr:hover { background-color: #2a2a2a; }
        
        .money { font-weight: 800; color: #f4d35e; } /* Gold color for money */
        
        .refresh-btn { 
            display: block; margin: 0 auto; padding: 10px 20px; 
            background: #d90429; color: white; border: none; 
            border-radius: 5px; cursor: pointer; font-size: 1rem; font-weight: bold;
        }
        .refresh-btn:hover { background: #b00020; }
        
        #status { text-align: center; color: #888; margin-top: 10px; font-style: italic; }
    </style>
</head>
<body>

<div class="container">
    <h1>üßß QU·∫¢N L√ù L√å X√å</h1>
    <button class="refresh-btn" onclick="location.reload()">üîÑ C·∫≠p nh·∫≠t danh s√°ch</button>
    <p id="status">ƒêang k·∫øt n·ªëi t·ªõi m√°y ch·ªß...</p>

    <table>
        <thead>
            <tr>
                <th>T√™n Ng∆∞·ªùi Ch∆°i</th>
                <th>S·ªë Ti·ªÅn</th>
                <th>Th·ªùi Gian</th>
            </tr>
        </thead>
        <tbody id="table-body">
            </tbody>
    </table>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // üëáüëáüëá PASTE YOUR FIREBASE CONFIG HERE üëáüëáüëá
    const firebaseConfig = {
        apiKey: "AIzaSyDRiJlbZLGrbZQ-vMV65Cow_e8No-9YCg0",
        authDomain: "luckymoney-fdd4b.firebaseapp.com",
        projectId: "luckymoney-fdd4b",
        storageBucket: "luckymoney-fdd4b.firebasestorage.app",
        messagingSenderId: "286269081249",
        appId: "1:286269081249:web:eb5d026bacde7364ed92e0",
        measurementId: "G-S53VEPH4Z7"
    };
    // üëÜüëÜüëÜ END PASTE üëÜüëÜüëÜ

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    async function loadData() {
        const statusText = document.getElementById('status');
        const tbody = document.getElementById('table-body');

        try {
            // Fetch data sorted by time (Newest first)
            // If this fails, it's usually an "Index" error (Check Console)
            const q = query(collection(db, "lixi_results"), orderBy("timestamp", "desc"));
            const querySnapshot = await getDocs(q);

            if (querySnapshot.empty) {
                statusText.innerText = "Database ƒë√£ k·∫øt n·ªëi, nh∆∞ng ch∆∞a c√≥ d·ªØ li·ªáu!";
                return;
            }

            statusText.innerText = `T√¨m th·∫•y ${querySnapshot.size} k·∫øt qu·∫£.`;
            statusText.style.color = "#4caf50"; // Green text for success

            tbody.innerHTML = ""; // Clear old data

            querySnapshot.forEach((doc) => {
                const data = doc.data();
                console.log("Found data:", data); // Check Console to see raw data
                
                const row = `
                    <tr>
                        <td><strong>${data.name}</strong></td>
                        <td class="money">${parseInt(data.money).toLocaleString('vi-VN')}ƒë</td>
                        <td>${data.formattedTime || "N/A"}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });

        } catch (error) {
            console.error("L·ªñI:", error);
            
            // Helpful Error Messages for You
            if (error.message.includes("requires an index")) {
                alert("‚ö†Ô∏è L·ªñI INDEX: B·∫°n c·∫ßn t·∫°o Index trong Firebase. M·ªü Console (F12) v√† b·∫•m v√†o ƒë∆∞·ªùng link m√†u xanh do Google cung c·∫•p!");
                statusText.innerText = "L·ªói: Thi·∫øu Index (Xem Console)";
            } else {
                statusText.innerText = "L·ªói k·∫øt n·ªëi: " + error.message;
            }
            statusText.style.color = "red";
        }
    }

    loadData();
</script>

</body>
</html>
